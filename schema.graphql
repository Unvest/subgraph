enum ProtocolVersion {
  v2
  v3
}

# VestingTokenFactory
type VestingTokenFactory @entity {
  id: String! # address
  # Fee collector
  feeCollector: Bytes!
  # Transfer Fee
  currentGlobalTransferFee: BigInt!
  nextGlobalTransferFee: BigInt!
  nextGlobalTransferFeeTime: BigInt!
  # Claim Fee
  currentGlobalClaimFee: BigInt!
  nextGlobalClaimFee: BigInt!
  nextGlobalClaimFeeTime: BigInt!
  # Tx info
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Misc
  version: ProtocolVersion!
}

type VestingTokenCustomTransferFee @entity {
  id: Bytes!
  isEnabled: Boolean!
  currentCustomValue: BigInt!
  nextCustomValue: BigInt!
  nextChangeAt: BigInt!
  willBeEnabled: Boolean!
  enableChangeAt: BigInt!

  vestingToken: VestingToken!

  updatedAt: BigInt!
}
type VestingTokenCustomClaimFee @entity {
  id: Bytes!
  isEnabled: Boolean!
  currentCustomValue: BigInt!
  nextCustomValue: BigInt!
  nextChangeAt: BigInt!
  willBeEnabled: Boolean!
  enableChangeAt: BigInt!

  vestingToken: VestingToken!

  updatedAt: BigInt!
}

# Redeem tokens (ERC20)
type RedeemToken @entity(immutable: true) {
  id: String! # address
  name: String!
  symbol: String!
  decimals: Int!
  vestingTokens: [VestingToken!]! @derivedFrom(field: "redeemToken")
}

# VestingToken
type VestingToken @entity {
  id: String! # address
  name: String!
  symbol: String!
  decimals: Int!
  redeemToken: RedeemToken! # address
  # Milestones
  milestones: [Milestone!]! @derivedFrom(field: "vestingToken")
  # Deployer
  deployer: String!
  # Vesting balance
  balance: VestingBalance! @derivedFrom(field: "vestingToken")
  # Holders
  holdersCount: Int!
  recipientsCount: Int!
  holders: [HolderBalance!]! @derivedFrom(field: "vestingToken")
  # DistributionBatches
  distributionBatches: [DistributionBatch!]! @derivedFrom(field: "vestingToken")
  # Tx info
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Misc
  version: ProtocolVersion!
  # Custom tranfer fee
  customTransferFee: VestingTokenCustomTransferFee @derivedFrom(field: "vestingToken")
  customClaimFee: VestingTokenCustomClaimFee @derivedFrom(field: "vestingToken")
}

type Claim @entity(immutable: true) {
  id: Bytes!
  vestingToken: VestingToken
  claimer: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Transfer @entity(immutable: true) {
  id: Bytes!
  vestingToken: VestingToken
  from: Bytes! # address
  to: Bytes! # address
  value: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  distributionBatch: DistributionBatch # Optional. Not all transfers will have a distribution batch. Just those that were minted
}

type DistributionBatch @entity(immutable: false) {
  id: String!
  vestingToken: VestingToken!
  totalAmount: BigInt!
  from: Bytes! # address
  recipients: [Transfer!]! @derivedFrom(field: "distributionBatch")
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type VestingBalance @entity {
  id: String!
  vestingToken: VestingToken!
  allocation: BigInt!
  claimed: BigInt!
  claimable: BigInt!
  locked: BigInt!
  updatedAt: BigInt!
  lastClaimedAt: BigInt
}

type HolderBalance @entity {
  id: String!
  user: String!
  vestingToken: VestingToken!
  isRecipient: Boolean!
  allocation: BigInt!
  claimed: BigInt!
  claimable: BigInt!
  locked: BigInt!
  balance: BigInt!
  updatedAt: BigInt!
  lastClaimedAt: BigInt
  transferredIn: BigInt!
  transferredOut: BigInt!
}

type Milestone @entity {
  id: String!
  vestingToken: VestingToken!
  timestamp: BigInt
  ramp: Int
  percentage: BigInt
}
